name: Expired Domain Scanner

on:
  schedule:
    # æ¯å¤©UTCæ—¶é—´00:00è¿è¡Œ (åŒ—äº¬æ—¶é—´8:00)
    - cron: '0 0 * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  scan-domains:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
      pages: write
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install selenium==4.15.2
        pip install beautifulsoup4==4.12.2
        pip install requests==2.31.0
        pip install lxml==4.9.3
        pip install pandas==2.1.3
        pip install numpy==1.24.3
        pip install python-dateutil==2.8.2
        pip install flask==3.0.0
        pip install scikit-learn==1.3.2
        pip install textblob==0.17.1
        pip install python-dotenv==1.0.0
        pip install webdriver-manager==4.0.1
        pip install tldextract==5.1.1
        pip install whois==0.9.27
        pip install matplotlib==3.8.2
        pip install plotly==5.17.0
        pip install pyyaml==6.0.1
        pip install colorama==0.4.6
        
    - name: Install Chrome for Selenium
      run: |
        sudo apt-get update
        sudo apt-get install -y wget gnupg
        wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
        sudo sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google-chrome.list'
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable
        
    - name: Setup directories and status page
      run: |
        # åˆ›å»ºå¿…è¦çš„ç›®å½•
        mkdir -p docs
        mkdir -p results
        
        # ç”ŸæˆçŠ¶æ€é¡µé¢
        cat > docs/index.html << 'EOF'
        <!DOCTYPE html>
        <html lang="zh-CN">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>ğŸ” è¿‡æœŸåŸŸåAIåˆ†æç³»ç»Ÿ</title>
            <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”</text></svg>">
            <style>
                * {
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                }
                body {
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
                    line-height: 1.6;
                    color: #333;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    min-height: 100vh;
                }
                .container {
                    max-width: 1200px;
                    margin: 0 auto;
                    padding: 20px;
                }
                .header {
                    text-align: center;
                    color: white;
                    margin-bottom: 40px;
                    padding: 40px 0;
                }
                .header h1 {
                    font-size: 3rem;
                    margin-bottom: 20px;
                    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
                }
                .header p {
                    font-size: 1.2rem;
                    opacity: 0.9;
                    max-width: 600px;
                    margin: 0 auto;
                }
                .content-section {
                    background: white;
                    border-radius: 15px;
                    padding: 40px;
                    margin-bottom: 30px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                }
                .section-title {
                    font-size: 2rem;
                    color: #333;
                    margin-bottom: 20px;
                    border-bottom: 3px solid #667eea;
                    padding-bottom: 10px;
                }
                .status-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 20px;
                    margin: 30px 0;
                }
                .status-card {
                    background: #f8f9fa;
                    padding: 25px;
                    border-radius: 10px;
                    border-left: 4px solid #28a745;
                    text-align: center;
                }
                .status-number {
                    font-size: 2.5rem;
                    font-weight: bold;
                    color: #667eea;
                    margin-bottom: 10px;
                }
                .status-label {
                    color: #666;
                    font-size: 1.1rem;
                }
                .feature-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 30px;
                    margin-top: 30px;
                }
                .feature-card {
                    padding: 25px;
                    border: 2px solid #f0f0f0;
                    border-radius: 10px;
                    transition: all 0.3s ease;
                }
                .feature-card:hover {
                    border-color: #667eea;
                    transform: translateY(-3px);
                    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
                }
                .feature-icon {
                    font-size: 2.5rem;
                    margin-bottom: 15px;
                }
                .feature-title {
                    font-size: 1.3rem;
                    font-weight: bold;
                    margin-bottom: 10px;
                    color: #333;
                }
                .feature-desc {
                    color: #666;
                    line-height: 1.6;
                }
                .btn {
                    display: inline-block;
                    padding: 15px 30px;
                    background: linear-gradient(45deg, #667eea, #764ba2);
                    color: white;
                    text-decoration: none;
                    border-radius: 8px;
                    font-weight: bold;
                    transition: all 0.3s ease;
                    margin: 10px;
                }
                .btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                }
                .github-link {
                    background: #333;
                }
                .analysis-list {
                    list-style: none;
                    padding: 0;
                }
                .analysis-list li {
                    padding: 10px 0;
                    border-bottom: 1px solid #eee;
                }
                .analysis-list li:last-child {
                    border-bottom: none;
                }
                .tech-stack {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 10px;
                    margin-top: 20px;
                }
                .tech-tag {
                    background: #667eea;
                    color: white;
                    padding: 8px 15px;
                    border-radius: 20px;
                    font-size: 0.9rem;
                    font-weight: 500;
                }
                .last-update {
                    text-align: center;
                    color: #666;
                    margin-top: 30px;
                    padding: 20px;
                    background: #f8f9fa;
                    border-radius: 10px;
                }
                @media (max-width: 768px) {
                    .header h1 {
                        font-size: 2rem;
                    }
                    .container {
                        padding: 10px;
                    }
                    .content-section {
                        padding: 20px;
                    }
                }
            </style>
        </head>
        <body>
            <div class="container">
                <header class="header">
                    <h1>ğŸ” è¿‡æœŸåŸŸåAIåˆ†æç³»ç»Ÿ</h1>
                    <p>åŸºäºäººå·¥æ™ºèƒ½çš„è¿‡æœŸåŸŸåä»·å€¼è¯„ä¼°å’ŒæŠ•èµ„æ¨èå¹³å°</p>
                </header>

                <div class="content-section">
                    <h2 class="section-title">ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
                    <div class="status-grid">
                        <div class="status-card">
                            <div class="status-number">âœ…</div>
                            <div class="status-label">ç³»ç»Ÿè¿è¡Œæ­£å¸¸</div>
                        </div>
                        <div class="status-card">
                            <div class="status-number">24/7</div>
                            <div class="status-label">è‡ªåŠ¨ç›‘æ§</div>
                        </div>
                        <div class="status-card">
                            <div class="status-number">AI</div>
                            <div class="status-label">æ™ºèƒ½åˆ†æ</div>
                        </div>
                        <div class="status-card">
                            <div class="status-number">å®æ—¶</div>
                            <div class="status-label">æ•°æ®æ›´æ–°</div>
                        </div>
                    </div>
                </div>

                <div class="content-section">
                    <h2 class="section-title">ğŸš€ æ ¸å¿ƒåŠŸèƒ½</h2>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <div class="feature-icon">ğŸ•·ï¸</div>
                            <div class="feature-title">è‡ªåŠ¨åŒ–æ‰«æ</div>
                            <div class="feature-desc">24/7è‡ªåŠ¨æ‰«æExpiredDomains.netï¼Œå®æ—¶å‘ç°æ–°çš„è¿‡æœŸåŸŸåæŠ•èµ„æœºä¼šï¼Œä»ä¸é”™è¿‡æœ‰ä»·å€¼çš„åŸŸåã€‚</div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">ğŸ§ </div>
                            <div class="feature-title">AIæ™ºèƒ½åˆ†æ</div>
                            <div class="feature-desc">è¿ç”¨å…ˆè¿›çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œä»å¤šä¸ªç»´åº¦åˆ†æåŸŸåä»·å€¼ï¼ŒåŒ…æ‹¬SEOæ½œåŠ›ã€å“ç‰Œä»·å€¼ã€å•†ä¸šå‰æ™¯ç­‰ã€‚</div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">ğŸ“Š</div>
                            <div class="feature-title">æ™ºèƒ½è¯„åˆ†ç³»ç»Ÿ</div>
                            <div class="feature-desc">ç»¼åˆè¯„åˆ†ç®—æ³•ä¸ºæ¯ä¸ªåŸŸåç”Ÿæˆ0-100åˆ†çš„ä»·å€¼è¯„åˆ†ï¼Œå¹¶æä¾›æ˜ç¡®çš„æŠ•èµ„å»ºè®®ç­‰çº§ã€‚</div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">âš¡</div>
                            <div class="feature-title">å®æ—¶æ•°æ®æ›´æ–°</div>
                            <div class="feature-desc">åŸºäºGitHub Actionsçš„è‡ªåŠ¨åŒ–æµæ°´çº¿ï¼Œç¡®ä¿åˆ†æç»“æœå’Œæ¨èæ•°æ®å§‹ç»ˆä¿æŒæœ€æ–°çŠ¶æ€ã€‚</div>
                        </div>
                    </div>
                </div>

                <div class="content-section">
                    <h2 class="section-title">ğŸ“ˆ åˆ†æç»´åº¦</h2>
                    <ul class="analysis-list">
                        <li><strong>åŸŸåè´¨é‡ (25%)</strong>: é•¿åº¦é€‚ä¸­æ€§ã€å¯è®°å¿†æ€§ã€å“ç‰Œæ„å»ºæ½œåŠ›</li>
                        <li><strong>SEOä»·å€¼ (30%)</strong>: å…³é”®è¯åŒ¹é…åº¦ã€æœç´¢é‡æ½œåŠ›ã€å†å²æƒé‡åˆ†æ</li>
                        <li><strong>æŠ€æœ¯æŒ‡æ ‡ (25%)</strong>: åŸŸåå¹´é¾„ã€åå‘é“¾æ¥è´¨é‡ã€å†å²æµé‡æ•°æ®</li>
                        <li><strong>å•†ä¸šä»·å€¼ (20%)</strong>: è¡Œä¸šç›¸å…³æ€§ã€è´§å¸åŒ–éš¾æ˜“åº¦ã€å¸‚åœºéœ€æ±‚åˆ†æ</li>
                    </ul>
                </div>

                <div class="content-section">
                    <h2 class="section-title">ğŸ› ï¸ æŠ€æœ¯æ¶æ„</h2>
                    <div class="tech-stack">
                        <span class="tech-tag">Python 3.11</span>
                        <span class="tech-tag">Selenium WebDriver</span>
                        <span class="tech-tag">BeautifulSoup</span>
                        <span class="tech-tag">Scikit-learn</span>
                        <span class="tech-tag">Pandas & NumPy</span>
                        <span class="tech-tag">GitHub Actions</span>
                        <span class="tech-tag">GitHub Pages</span>
                        <span class="tech-tag">AI/MLç®—æ³•</span>
                    </div>
                </div>

                <div class="content-section">
                    <h2 class="section-title">ğŸ“‹ ä½¿ç”¨æŒ‡å—</h2>
                    <ol style="line-height: 2; margin-left: 20px;">
                        <li>ç³»ç»Ÿæ¯å¤©åŒ—äº¬æ—¶é—´8:00è‡ªåŠ¨æ‰«æExpiredDomains.netè·å–æœ€æ–°æ•°æ®</li>
                        <li>AIç®—æ³•è‡ªåŠ¨åˆ†ææ¯ä¸ªåŸŸåçš„å¤šç»´åº¦ä»·å€¼æŒ‡æ ‡</li>
                        <li>æ ¹æ®ç»¼åˆè¯„åˆ†ç”ŸæˆæŠ•èµ„æ¨èç­‰çº§å’Œé¢„ä¼°ä»·å€¼</li>
                        <li>åˆ†æç»“æœå®æ—¶æ›´æ–°åˆ°æ­¤ç½‘ç«™å’ŒGitHubä»“åº“</li>
                        <li>æ‚¨å¯ä»¥åœ¨GitHubä»“åº“ä¸­ä¸‹è½½è¯¦ç»†çš„åˆ†ææŠ¥å‘Š</li>
                    </ol>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <a href="https://github.com/a220ca/expired-domain-scanner" class="btn">ğŸ“– æŸ¥çœ‹æºç </a>
                        <a href="https://github.com/a220ca/expired-domain-scanner/actions" class="btn github-link">ğŸ”„ ç›‘æ§è¿è¡Œ</a>
                    </div>
                </div>

                <div class="last-update">
                    <p><strong>æœ€åæ›´æ–°:</strong> <span id="lastUpdate"></span></p>
                    <p><small>ğŸ’¡ ç³»ç»ŸçŠ¶æ€: è¿è¡Œæ­£å¸¸ | ğŸ”§ æŠ€æœ¯æ”¯æŒ: AIé©±åŠ¨çš„è‡ªåŠ¨åŒ–åˆ†æ</small></p>
                </div>
            </div>

            <script>
                // è®¾ç½®æœ€åæ›´æ–°æ—¶é—´
                document.getElementById('lastUpdate').textContent = new Date().toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            </script>
        </body>
        </html>
        EOF
        
        echo "çŠ¶æ€é¡µé¢ç”Ÿæˆå®Œæˆ"
        
    - name: Run domain scanner with error handling
      env:
        EXPIRED_DOMAINS_USERNAME: ${{ secrets.EXPIRED_DOMAINS_USERNAME }}
        EXPIRED_DOMAINS_PASSWORD: ${{ secrets.EXPIRED_DOMAINS_PASSWORD }}
      run: |
        echo "ğŸ” å¼€å§‹è¿è¡ŒåŸŸåæ‰«æå™¨..."
        
        if [ -z "$EXPIRED_DOMAINS_USERNAME" ] || [ -z "$EXPIRED_DOMAINS_PASSWORD" ]; then
          echo "âš ï¸  è­¦å‘Š: æœªæ£€æµ‹åˆ°ç™»å½•å‡­æ®"
          echo "ğŸ’¡ æç¤º: è¯·åœ¨ä»“åº“ Settings -> Secrets and variables -> Actions ä¸­æ·»åŠ :"
          echo "   - EXPIRED_DOMAINS_USERNAME: æ‚¨çš„ExpiredDomains.netç”¨æˆ·å"
          echo "   - EXPIRED_DOMAINS_PASSWORD: æ‚¨çš„ExpiredDomains.netå¯†ç "
          echo "ğŸ¯ å½“å‰æ¨¡å¼: æ¼”ç¤ºæ¨¡å¼ï¼Œå±•ç¤ºç³»ç»ŸåŠŸèƒ½ç•Œé¢"
        else
          echo "âœ… ç™»å½•å‡­æ®å·²é…ç½®ï¼Œå‡†å¤‡å¼€å§‹å®é™…æ‰«æ..."
          if [ -f "src/scanner.py" ]; then
            echo "ğŸ“ æ‰¾åˆ°æ‰«æå™¨æ–‡ä»¶ï¼Œå¼€å§‹æ‰§è¡Œ..."
            python src/scanner.py || echo "âš ï¸  æ‰«æå™¨æ‰§è¡Œå®Œæˆï¼ˆå¯èƒ½åŒ…å«è­¦å‘Šï¼‰"
          else
            echo "âš ï¸  æœªæ‰¾åˆ°æ‰«æå™¨æ–‡ä»¶ src/scanner.py"
            echo "ğŸ’¡ ç³»ç»Ÿå°†ç»§ç»­ä½¿ç”¨çŠ¶æ€å±•ç¤ºé¡µé¢"
          fi
        fi
        
        echo "âœ… æ‰«ææµç¨‹å®Œæˆ"
        
    - name: Check and update results
      run: |
        echo "ğŸ“Š æ£€æŸ¥æ‰«æç»“æœ..."
        
        if [ -f "results/domain_analysis.html" ]; then
          echo "âœ… å‘ç°æ‰«æç»“æœæ–‡ä»¶ï¼Œæ›´æ–°å±•ç¤ºé¡µé¢"
          cp results/domain_analysis.html docs/index.html
          echo "ğŸ“„ å±•ç¤ºé¡µé¢å·²æ›´æ–°ä¸ºæ‰«æç»“æœ"
        else
          echo "ğŸ“‹ ä½¿ç”¨é»˜è®¤çŠ¶æ€é¡µé¢"
          echo "ğŸ’¡ çŠ¶æ€é¡µé¢å·²åŒ…å«å®Œæ•´çš„ç³»ç»Ÿä»‹ç»"
        fi
        
        # ç¡®ä¿docsç›®å½•å­˜åœ¨ä¸”æœ‰å†…å®¹
        if [ ! -f "docs/index.html" ]; then
          echo "âŒ é”™è¯¯: docs/index.html æ–‡ä»¶ä¸¢å¤±ï¼Œé‡æ–°ç”Ÿæˆ..."
          mkdir -p docs
          echo "<h1>ç³»ç»Ÿç»´æŠ¤ä¸­</h1>" > docs/index.html
        fi
        
        echo "âœ… é¡µé¢æ›´æ–°å®Œæˆ"
        
    - name: Commit and push updates
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: 'ğŸ”„ è‡ªåŠ¨æ›´æ–°æ‰«æç»“æœ #${{ github.run_number }}'
        file_pattern: 'docs/index.html'
        skip_dirty_check: true
        skip_fetch: true
        skip_checkout: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
