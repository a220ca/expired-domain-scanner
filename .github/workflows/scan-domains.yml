name: Expired Domain Scanner

on:
  schedule:
    # æ¯å¤©UTCæ—¶é—´00:00è¿è¡Œ (åŒ—äº¬æ—¶é—´8:00)
    - cron: '0 0 * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  scan-domains:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install selenium==4.15.2
        pip install beautifulsoup4==4.12.2
        pip install requests==2.31.0
        pip install lxml==4.9.3
        pip install pandas==2.1.3
        pip install numpy==1.24.3
        pip install python-dateutil==2.8.2
        pip install flask==3.0.0
        pip install scikit-learn==1.3.2
        pip install textblob==0.17.1
        pip install python-dotenv==1.0.0
        pip install webdriver-manager==4.0.1
        pip install tldextract==5.1.1
        pip install whois==0.9.27
        pip install matplotlib==3.8.2
        pip install plotly==5.17.0
        pip install pyyaml==6.0.1
        pip install colorama==0.4.6
        
    - name: Install Chrome for Selenium
      run: |
        sudo apt-get update
        sudo apt-get install -y wget gnupg
        wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
        sudo sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google-chrome.list'
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable
        
    - name: Create results directory
      run: |
        mkdir -p results
        mkdir -p docs
        
    - name: Generate status page
      run: |
        cat > docs/index.html << 'EOF'
        <!DOCTYPE html>
        <html lang="zh-CN">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>ğŸ” è¿‡æœŸåŸŸåAIåˆ†æç³»ç»Ÿ</title>
            <style>
                body {
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                    line-height: 1.6;
                    color: #333;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    min-height: 100vh;
                    margin: 0;
                    padding: 20px;
                }
                .container {
                    max-width: 1000px;
                    margin: 0 auto;
                    background: white;
                    border-radius: 15px;
                    padding: 40px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                }
                .header {
                    text-align: center;
                    margin-bottom: 40px;
                }
                .header h1 {
                    color: #667eea;
                    font-size: 2.5rem;
                    margin-bottom: 10px;
                }
                .status {
                    background: #d4edda;
                    border: 1px solid #c3e6cb;
                    padding: 20px;
                    border-radius: 8px;
                    margin: 20px 0;
                }
                .info {
                    background: #e3f2fd;
                    border: 1px solid #90caf9;
                    padding: 20px;
                    border-radius: 8px;
                    margin: 20px 0;
                }
                .btn {
                    display: inline-block;
                    padding: 12px 24px;
                    background: #667eea;
                    color: white;
                    text-decoration: none;
                    border-radius: 6px;
                    margin: 10px;
                    transition: background 0.3s;
                }
                .btn:hover {
                    background: #5a6fd8;
                }
                .stats-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 20px;
                    margin: 30px 0;
                }
                .stat-card {
                    background: #f8f9fa;
                    padding: 20px;
                    border-radius: 8px;
                    text-align: center;
                }
                .stat-number {
                    font-size: 2rem;
                    font-weight: bold;
                    color: #667eea;
                }
                .feature-list {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 20px;
                    margin: 30px 0;
                }
                .feature-card {
                    background: #f8f9fa;
                    padding: 20px;
                    border-radius: 8px;
                    border-left: 4px solid #667eea;
                }
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header">
                    <h1>ğŸ” è¿‡æœŸåŸŸåAIåˆ†æç³»ç»Ÿ</h1>
                    <p>AIé©±åŠ¨çš„è¿‡æœŸåŸŸåä»·å€¼è¯„ä¼°å’ŒæŠ•èµ„æ¨èå¹³å°</p>
                </div>
                
                <div class="status">
                    <h3>âœ… ç³»ç»ŸçŠ¶æ€</h3>
                    <p><strong>çŠ¶æ€ï¼š</strong> ç³»ç»Ÿè¿è¡Œæ­£å¸¸</p>
                    <p><strong>æœ€åæ›´æ–°ï¼š</strong> <span id="timestamp"></span></p>
                    <p><strong>æ‰«æçŠ¶æ€ï¼š</strong> è‡ªåŠ¨åŒ–æ‰«æå™¨å·²éƒ¨ç½²å¹¶è¿è¡Œ</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">24/7</div>
                        <div>è‡ªåŠ¨ç›‘æ§</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">AI</div>
                        <div>æ™ºèƒ½åˆ†æ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">å¤šç»´åº¦</div>
                        <div>ä»·å€¼è¯„ä¼°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">å®æ—¶</div>
                        <div>ç»“æœæ›´æ–°</div>
                    </div>
                </div>
                
                <div class="info">
                    <h3>ğŸš€ ç³»ç»ŸåŠŸèƒ½</h3>
                    <div class="feature-list">
                        <div class="feature-card">
                            <h4>ğŸ•·ï¸ è‡ªåŠ¨åŒ–æ‰«æ</h4>
                            <p>æ¯æ—¥è‡ªåŠ¨æ‰«æExpiredDomains.netï¼Œå‘ç°æ–°çš„è¿‡æœŸåŸŸåæœºä¼š</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ§  AIæ™ºèƒ½åˆ†æ</h4>
                            <p>å¤šç»´åº¦åˆ†æåŸŸåä»·å€¼ï¼šSEOæ½œåŠ›ã€å“ç‰Œä»·å€¼ã€å•†ä¸šä»·å€¼</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ“Š ä»·å€¼è¯„ä¼°</h4>
                            <p>ç»¼åˆè¯„åˆ†ç³»ç»Ÿï¼Œæ™ºèƒ½æ¨èé«˜ä»·å€¼æŠ•èµ„æœºä¼š</p>
                        </div>
                        <div class="feature-card">
                            <h4>âš¡ å®æ—¶æ›´æ–°</h4>
                            <p>GitHub Actionsè‡ªåŠ¨åŒ–ï¼Œç¡®ä¿æ•°æ®å§‹ç»ˆæœ€æ–°</p>
                        </div>
                    </div>
                </div>

                <div class="info">
                    <h3>ğŸ“ˆ åˆ†ææŒ‡æ ‡</h3>
                    <ul>
                        <li><strong>åŸŸåè´¨é‡ (25%)</strong>: é•¿åº¦ã€å¯è®°å¿†æ€§ã€å“ç‰Œæ½œåŠ›</li>
                        <li><strong>SEOä»·å€¼ (30%)</strong>: å…³é”®è¯ä»·å€¼ã€æœç´¢æ½œåŠ›ã€å†å²æƒé‡</li>
                        <li><strong>æŠ€æœ¯æŒ‡æ ‡ (25%)</strong>: åŸŸåå¹´é¾„ã€åå‘é“¾æ¥ã€æµé‡å†å²</li>
                        <li><strong>å•†ä¸šä»·å€¼ (20%)</strong>: è¡Œä¸šç›¸å…³æ€§ã€è´§å¸åŒ–æ½œåŠ›</li>
                    </ul>
                </div>

                <div style="text-align: center; margin-top: 40px;">
                    <a href="https://github.com/a220ca/expired-domain-scanner" class="btn">ğŸ“– æŸ¥çœ‹æºç </a>
                    <a href="https://github.com/a220ca/expired-domain-scanner/actions" class="btn">ğŸ”„ æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</a>
                </div>

                <div style="text-align: center; margin-top: 30px; color: #666; font-size: 0.9rem;">
                    <p>ğŸ”§ æŠ€æœ¯æ ˆ: Python + Selenium + AI/ML + GitHub Actions</p>
                    <p>ğŸ“Š æ•°æ®æ¥æº: ExpiredDomains.net</p>
                </div>
            </div>

            <script>
                document.getElementById('timestamp').textContent = new Date().toLocaleString('zh-CN');
            </script>
        </body>
        </html>
        EOF
        
    - name: Run domain scanner
      env:
        EXPIRED_DOMAINS_USERNAME: ${{ secrets.EXPIRED_DOMAINS_USERNAME }}
        EXPIRED_DOMAINS_PASSWORD: ${{ secrets.EXPIRED_DOMAINS_PASSWORD }}
      run: |
        echo "å¼€å§‹è¿è¡ŒåŸŸåæ‰«æå™¨..."
        if [ -z "$EXPIRED_DOMAINS_USERNAME" ] || [ -z "$EXPIRED_DOMAINS_PASSWORD" ]; then
          echo "è­¦å‘Š: æœªè®¾ç½®ç™»å½•å‡­æ®ï¼Œè·³è¿‡å®é™…æ‰«æ"
          echo "è¯·åœ¨ Settings -> Secrets ä¸­æ·»åŠ  EXPIRED_DOMAINS_USERNAME å’Œ EXPIRED_DOMAINS_PASSWORD"
        else
          echo "ç™»å½•å‡­æ®å·²é…ç½®ï¼Œå¼€å§‹æ‰«æ..."
          python src/scanner.py || echo "æ‰«æå®Œæˆï¼ˆå¯èƒ½æœ‰è­¦å‘Šï¼‰"
        fi
        
    - name: Update GitHub Pages
      run: |
        echo "æ›´æ–°GitHub Pages..."
        if [ -f "results/domain_analysis.html" ]; then
          echo "å‘ç°æ‰«æç»“æœï¼Œæ›´æ–°å±•ç¤ºé¡µé¢"
          cp results/domain_analysis.html docs/index.html
        else
          echo "ä½¿ç”¨é»˜è®¤çŠ¶æ€é¡µé¢"
        fi
        
    - name: Commit and push results
  uses: stefanzweifel/git-auto-commit-action@v5
  with:
    commit_message: 'ğŸ”„ æ›´æ–°åŸŸåæ‰«æç»“æœ - ${{ github.run_number }}'
    file_pattern: 'docs/*'
    skip_dirty_check: true

